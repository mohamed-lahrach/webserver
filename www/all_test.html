<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ Comprehensive CGI Testing Suite</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
        }
        
        .test-section {
            margin-bottom: 40px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .section-header {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .section-header h2 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .section-content {
            padding: 25px;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .test-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .test-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .test-card h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #495057;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ced4da;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        textarea {
            resize: vertical;
            min-height: 80px;
            font-family: 'Courier New', monospace;
        }
        
        .btn {
            background: #4CAF50;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin: 5px;
        }
        
        .btn:hover {
            background: #45a049;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .btn-danger {
            background: #dc3545;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .btn-info {
            background: #17a2b8;
        }
        
        .btn-info:hover {
            background: #138496;
        }
        
        .curl-commands {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 15px 0;
        }
        
        .curl-commands h4 {
            color: #4fd1c7;
            margin-bottom: 15px;
        }
        
        .curl-commands pre {
            margin: 10px 0;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            border-left: 3px solid #4fd1c7;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-success { background: #28a745; }
        .status-warning { background: #ffc107; }
        .status-error { background: #dc3545; }
        
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 5px 5px 0;
        }
        
        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 5px 5px 0;
        }
        
        .success-box {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 5px 5px 0;
        }
        
        .quick-links {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
        }
        
        .quick-links a {
            background: #007bff;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            text-decoration: none;
            font-size: 12px;
            transition: background 0.3s ease;
        }
        
        .quick-links a:hover {
            background: #0056b3;
        }
        
        @media (max-width: 768px) {
            .test-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Comprehensive CGI Testing Suite</h1>
            <p>Complete testing environment for webserv CGI functionality evaluation</p>
        </div>
        
        <div class="content">
            <!-- Quick Navigation -->
            <div class="quick-links">
                <a href="#get-tests">GET Tests</a>
                <a href="#post-tests">POST Tests</a>
                <a href="#file-tests">File Upload Tests</a>
                <a href="#error-tests">Error Handling</a>
                <a href="#stress-tests">Stress Tests</a>
                <a href="#curl-commands">cURL Commands</a>
            </div>
            
            <!-- Status Overview -->
            <div class="info-box">
                <h3>üéØ Testing Objectives (Based on Correction Sheet)</h3>
                <ul>
                    <li><span class="status-indicator status-success"></span>CGI works with GET and POST methods</li>
                    <li><span class="status-indicator status-warning"></span>CGI runs in correct directory for relative path access</li>
                    <li><span class="status-indicator status-error"></span>Error handling works properly (infinite loops, errors)</li>
                    <li><span class="status-indicator status-success"></span>Server never crashes during CGI execution</li>
                </ul>
            </div>     
       
            <!-- GET Tests Section -->
            <div class="test-section" id="get-tests">
                <div class="section-header">
                    <h2>üîç GET Request Tests</h2>
                    <p>Testing basic CGI functionality with GET requests</p>
                </div>
                <div class="section-content">
                    <div class="test-grid">
                        <div class="test-card">
                            <h3>Basic CGI Script</h3>
                            <p>Simple "Hello World" CGI test</p>
                            <a href="/cgi-bin/hello.py" target="_blank" class="btn">Test Basic CGI</a>
                        </div>
                        
                        <div class="test-card">
                            <h3>Directory Test</h3>
                            <p>Verify CGI runs in correct directory</p>
                            <a href="/cgi-bin/directory_test.py" target="_blank" class="btn">Test Directory</a>
                        </div>
                        
                        <div class="test-card">
                            <h3>Relative Path Test</h3>
                            <p>Test file access with relative paths</p>
                            <a href="/cgi-bin/relative_path_test.py" target="_blank" class="btn">Test Paths</a>
                        </div>
                        
                        <div class="test-card">
                            <h3>Environment Variables</h3>
                            <p>Check CGI environment setup</p>
                            <a href="/cgi-bin/enhanced_test.py" target="_blank" class="btn">Test Environment</a>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- POST Tests Section -->
            <div class="test-section" id="post-tests">
                <div class="section-header">
                    <h2>üì§ POST Request Tests</h2>
                    <p>Testing CGI with various POST data formats</p>
                </div>
                <div class="section-content">
                    <div class="test-grid">
                        <div class="test-card">
                            <h3>Simple Form Data</h3>
                            <form action="/cgi-bin/post_test.py" method="POST" target="_blank">
                                <div class="form-group">
                                    <label>Name:</label>
                                    <input type="text" name="username" value="TestUser">
                                </div>
                                <div class="form-group">
                                    <label>Message:</label>
                                    <textarea name="message">Hello from CGI POST test!</textarea>
                                </div>
                                <button type="submit" class="btn">Submit Form</button>
                            </form>
                        </div>
                        
                        <div class="test-card">
                            <h3>Raw Text Data</h3>
                            <form id="rawTextForm">
                                <div class="form-group">
                                    <label>Raw Data:</label>
                                    <textarea id="rawTextData" placeholder="Enter any raw text data...">{"test": "json data", "number": 42}</textarea>
                                </div>
                                <button type="button" class="btn" onclick="sendRawData('text')">Send Raw Data</button>
                            </form>
                        </div>
                        
                        <div class="test-card">
                            <h3>Large Data Test</h3>
                            <form id="largeDataForm">
                                <div class="form-group">
                                    <label>Data Size:</label>
                                    <select id="dataSize">
                                        <option value="1024">1 KB</option>
                                        <option value="10240">10 KB</option>
                                        <option value="102400">100 KB</option>
                                        <option value="1048576">1 MB</option>
                                    </select>
                                </div>
                                <button type="button" class="btn" onclick="sendLargeData()">Send Large Data</button>
                            </form>
                        </div>
                        
                        <div class="test-card">
                            <h3>Chunked Transfer</h3>
                            <p>Test chunked transfer encoding</p>
                            <button type="button" class="btn" onclick="sendChunkedData()">Send Chunked</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- File Upload Tests -->
            <div class="test-section" id="file-tests">
                <div class="section-header">
                    <h2>üìÅ File Upload Tests</h2>
                    <p>Testing file uploads and binary data handling</p>
                </div>
                <div class="section-content">
                    <div class="test-grid">
                        <div class="test-card">
                            <h3>Image Upload</h3>
                            <form id="imageUploadForm">
                                <div class="form-group">
                                    <label>Select Image:</label>
                                    <input type="file" id="imageFile" accept="image/*">
                                </div>
                                <button type="button" class="btn" onclick="uploadFile('image')">Upload Image</button>
                            </form>
                        </div>
                        
                        <div class="test-card">
                            <h3>Video Upload</h3>
                            <form id="videoUploadForm">
                                <div class="form-group">
                                    <label>Select Video:</label>
                                    <input type="file" id="videoFile" accept="video/*">
                                </div>
                                <button type="button" class="btn" onclick="uploadFile('video')">Upload Video</button>
                            </form>
                        </div>
                        
                        <div class="test-card">
                            <h3>Text File Upload</h3>
                            <form id="textFileForm">
                                <div class="form-group">
                                    <label>Select Text File:</label>
                                    <input type="file" id="textFile" accept=".txt,.log,.md,.json,.xml">
                                </div>
                                <button type="button" class="btn" onclick="uploadFile('text')">Upload Text File</button>
                            </form>
                        </div>
                        
                        <div class="test-card">
                            <h3>Multiple Files</h3>
                            <form id="multiFileForm">
                                <div class="form-group">
                                    <label>Select Multiple Files:</label>
                                    <input type="file" id="multiFiles" multiple>
                                </div>
                                <button type="button" class="btn" onclick="uploadMultipleFiles()">Upload Multiple</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Error Handling Tests -->
            <div class="test-section" id="error-tests">
                <div class="section-header">
                    <h2>‚ö†Ô∏è Error Handling Tests</h2>
                    <p>Testing CGI error scenarios and server stability</p>
                </div>
                <div class="section-content">
                    <div class="warning-box">
                        <strong>‚ö†Ô∏è Important:</strong> These tests are designed to check error handling. The server should never crash!
                    </div>
                    
                    <div class="test-grid">
                        <div class="test-card">
                            <h3>Non-existent CGI</h3>
                            <p>Test 404 handling for missing CGI scripts</p>
                            <a href="/cgi-bin/nonexistent.py" target="_blank" class="btn btn-danger">Test 404</a>
                        </div>
                        
                        <div class="test-card">
                            <h3>Syntax Error Script</h3>
                            <p>CGI script with Python syntax errors</p>
                            <button type="button" class="btn btn-danger" onclick="createErrorScript('syntax')">Create & Test</button>
                        </div>
                        
                        <div class="test-card">
                            <h3>Infinite Loop Script</h3>
                            <p>CGI script that runs indefinitely</p>
                            <button type="button" class="btn btn-danger" onclick="createErrorScript('infinite')">Create & Test</button>
                        </div>
                        
                        <div class="test-card">
                            <h3>Memory Intensive Script</h3>
                            <p>CGI script that consumes lots of memory</p>
                            <button type="button" class="btn btn-danger" onclick="createErrorScript('memory')">Create & Test</button>
                        </div>
                        
                        <div class="test-card">
                            <h3>File Permission Error</h3>
                            <p>CGI script without execute permissions</p>
                            <button type="button" class="btn btn-danger" onclick="createErrorScript('permission')">Create & Test</button>
                        </div>
                        
                        <div class="test-card">
                            <h3>Invalid Headers</h3>
                            <p>CGI script with malformed HTTP headers</p>
                            <button type="button" class="btn btn-danger" onclick="createErrorScript('headers')">Create & Test</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Stress Tests -->
            <div class="test-section" id="stress-tests">
                <div class="section-header">
                    <h2>üî• Stress Tests</h2>
                    <p>Testing server performance and stability under load</p>
                </div>
                <div class="section-content">
                    <div class="test-grid">
                        <div class="test-card">
                            <h3>Concurrent Requests</h3>
                            <div class="form-group">
                                <label>Number of concurrent requests:</label>
                                <select id="concurrentCount">
                                    <option value="10">10 requests</option>
                                    <option value="50">50 requests</option>
                                    <option value="100">100 requests</option>
                                </select>
                            </div>
                            <button type="button" class="btn" onclick="runConcurrentTest()">Run Concurrent Test</button>
                        </div>
                        
                        <div class="test-card">
                            <h3>Rapid Fire Requests</h3>
                            <p>Send requests as fast as possible</p>
                            <button type="button" class="btn" onclick="runRapidFireTest()">Start Rapid Fire</button>
                            <button type="button" class="btn btn-danger" onclick="stopRapidFire()">Stop</button>
                        </div>
                        
                        <div class="test-card">
                            <h3>Large POST Stress</h3>
                            <p>Multiple large POST requests</p>
                            <button type="button" class="btn" onclick="runLargePostStress()">Run Large POST Stress</button>
                        </div>
                        
                        <div class="test-card">
                            <h3>Mixed Request Types</h3>
                            <p>Random mix of GET/POST/file uploads</p>
                            <button type="button" class="btn" onclick="runMixedStress()">Run Mixed Stress</button>
                        </div>
                    </div>
                    
                    <div id="stressResults" style="display: none;">
                        <h3>Stress Test Results</h3>
                        <div id="stressOutput"></div>
                    </div>
                </div>
            </div>     
       
            <!-- cURL Commands Section -->
            <div class="test-section" id="curl-commands">
                <div class="section-header">
                    <h2>üíª cURL Command Reference</h2>
                    <p>Manual testing commands for comprehensive CGI evaluation</p>
                </div>
                <div class="section-content">
                    <div class="curl-commands">
                        <h4>üîç GET Request Tests</h4>
                        <pre># Basic CGI GET request
curl -v http://localhost:3080/cgi-bin/hello.py

# GET with query parameters
curl -v "http://localhost:3080/cgi-bin/test.py?name=test&value=123"

# GET with custom headers
curl -v -H "User-Agent: TestClient/1.0" http://localhost:3080/cgi-bin/hello.py</pre>
                        
                        <h4>üì§ POST Request Tests</h4>
                        <pre># Simple form data POST
curl -X POST http://localhost:3080/cgi-bin/post_test.py \
     -d "username=testuser&email=test@example.com&message=hello"

# JSON POST data
curl -X POST http://localhost:3080/cgi-bin/post_test.py \
     -H "Content-Type: application/json" \
     -d '{"name": "John", "age": 30, "city": "New York"}'

# Raw text POST
curl -X POST http://localhost:3080/cgi-bin/post_test.py \
     -H "Content-Type: text/plain" \
     -d "This is raw text data for testing"

# Large POST data (1MB)
curl -X POST http://localhost:3080/cgi-bin/post_test.py \
     -d "$(python3 -c 'print("x" * 1048576)')"</pre>
                        
                        <h4>üìÅ File Upload Tests</h4>
                        <pre># Upload a text file
curl -X POST http://localhost:3080/cgi-bin/file_handler.py \
     -H "Content-Type: application/octet-stream" \
     -H "X-File-Name: test.txt" \
     --data-binary @/path/to/your/file.txt

# Upload an image
curl -X POST http://localhost:3080/cgi-bin/file_handler.py \
     -H "Content-Type: application/octet-stream" \
     -H "X-File-Name: image.jpg" \
     --data-binary @/path/to/your/image.jpg

# Upload with multipart form data
curl -X POST http://localhost:3080/cgi-bin/post_test.py \
     -F "file=@/path/to/your/file.txt" \
     -F "description=Test file upload"</pre>
                        
                        <h4>‚ö†Ô∏è Error Testing</h4>
                        <pre># Test non-existent CGI
curl -v http://localhost:3080/cgi-bin/nonexistent.py

# Test with invalid method
curl -X INVALID http://localhost:3080/cgi-bin/hello.py

# Test with malformed headers
curl -H "Invalid-Header" http://localhost:3080/cgi-bin/hello.py</pre>
                        
                        <h4>üî• Stress Testing</h4>
                        <pre># Concurrent requests (requires GNU parallel)
seq 1 100 | parallel -j 10 curl -s http://localhost:3080/cgi-bin/hello.py

# Rapid fire requests
for i in {1..100}; do curl -s http://localhost:3080/cgi-bin/hello.py & done; wait

# Large POST stress test
for i in {1..10}; do 
  curl -X POST http://localhost:3080/cgi-bin/post_test.py \
       -d "$(python3 -c 'print("data" * 10000)')" &
done; wait</pre>
                        
                        <h4>üß™ Advanced Testing</h4>
                        <pre># Test chunked transfer encoding
curl -X POST http://localhost:3080/cgi-bin/post_test.py \
     -H "Transfer-Encoding: chunked" \
     -d "This is chunked data"

# Test with cookies
curl -b "session=abc123; user=testuser" http://localhost:3080/cgi-bin/cookie_reader.py

# Test with authentication headers
curl -H "Authorization: Bearer token123" http://localhost:3080/cgi-bin/hello.py

# Test connection keep-alive
curl -H "Connection: keep-alive" http://localhost:3080/cgi-bin/hello.py</pre>
                    </div>
                </div>
            </div>
            
            <!-- Session and Cookie Tests -->
            <div class="test-section">
                <div class="section-header">
                    <h2>üç™ Session & Cookie Tests (Bonus)</h2>
                    <p>Testing session management and cookie functionality</p>
                </div>
                <div class="section-content">
                    <div class="test-grid">
                        <div class="test-card">
                            <h3>Session Creation</h3>
                            <p>Create a new session with cookies</p>
                            <a href="/cgi-bin/session_test.py" target="_blank" class="btn">Create Session</a>
                        </div>
                        
                        <div class="test-card">
                            <h3>Cookie Reader</h3>
                            <p>Read and display current cookies</p>
                            <a href="/cgi-bin/cookie_reader.py" target="_blank" class="btn">Read Cookies</a>
                        </div>
                        
                        <div class="test-card">
                            <h3>Session Data</h3>
                            <form action="/cgi-bin/session_test.py" method="POST" target="_blank">
                                <div class="form-group">
                                    <label>Store Data:</label>
                                    <input type="text" name="session_data" value="test session data">
                                </div>
                                <button type="submit" class="btn">Store in Session</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Results and Monitoring -->
            <div class="test-section">
                <div class="section-header">
                    <h2>üìä Test Results & Monitoring</h2>
                    <p>Monitor test results and server behavior</p>
                </div>
                <div class="section-content">
                    <div class="success-box">
                        <h3>‚úÖ What to Look For (Correction Criteria)</h3>
                        <ul>
                            <li><strong>Server Stability:</strong> Server should never crash during any test</li>
                            <li><strong>Correct Directory:</strong> CGI scripts should run in the correct directory for relative file access</li>
                            <li><strong>GET/POST Support:</strong> Both GET and POST methods should work properly</li>
                            <li><strong>Error Handling:</strong> Errors should be visible but not crash the server</li>
                            <li><strong>Status Codes:</strong> Appropriate HTTP status codes should be returned</li>
                            <li><strong>File Access:</strong> CGI should be able to access files using relative paths</li>
                        </ul>
                    </div>
                    
                    <div class="info-box">
                        <h3>üîç Monitoring Tips</h3>
                        <ul>
                            <li>Check server logs for error messages</li>
                            <li>Monitor memory usage during stress tests</li>
                            <li>Verify HTTP response headers are correct</li>
                            <li>Test with browser developer tools network tab</li>
                            <li>Use tools like <code>htop</code> or <code>ps</code> to monitor processes</li>
                        </ul>
                    </div>
                    
                    <div id="testLog" style="display: none;">
                        <h3>Test Execution Log</h3>
                        <div id="logOutput" style="background: #f8f9fa; padding: 15px; border-radius: 5px; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto;"></div>
                        <button type="button" class="btn btn-secondary" onclick="clearLog()">Clear Log</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Global variables for stress testing
        let rapidFireInterval;
        let testCounter = 0;
        
        // Logging function
        function log(message) {
            const logDiv = document.getElementById('testLog');
            const logOutput = document.getElementById('logOutput');
            const timestamp = new Date().toLocaleTimeString();
            
            logOutput.innerHTML += `[${timestamp}] ${message}\n`;
            logDiv.style.display = 'block';
            logOutput.scrollTop = logOutput.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('logOutput').innerHTML = '';
            document.getElementById('testLog').style.display = 'none';
        }
        
        // Send raw text data
        function sendRawData(type) {
            const data = document.getElementById('rawTextData').value;
            log(`Sending raw ${type} data (${data.length} bytes)`);
            
            fetch('/cgi-bin/post_test.py', {
                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain'
                },
                body: data
            })
            .then(response => {
                log(`Response status: ${response.status}`);
                return response.text();
            })
            .then(html => {
                const newWindow = window.open('', '_blank');
                newWindow.document.write(html);
                newWindow.document.close();
            })
            .catch(error => {
                log(`Error: ${error}`);
            });
        }
        
        // Send large data
        function sendLargeData() {
            const size = parseInt(document.getElementById('dataSize').value);
            const data = 'x'.repeat(size);
            log(`Sending large data (${size} bytes)`);
            
            fetch('/cgi-bin/post_test.py', {
                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain'
                },
                body: data
            })
            .then(response => {
                log(`Large data response status: ${response.status}`);
                return response.text();
            })
            .then(html => {
                const newWindow = window.open('', '_blank');
                newWindow.document.write(html);
                newWindow.document.close();
            })
            .catch(error => {
                log(`Large data error: ${error}`);
            });
        }
        
        // Send chunked data
        function sendChunkedData() {
            log('Sending chunked transfer encoding data');
            
            fetch('/cgi-bin/post_test.py', {
                method: 'POST',
                headers: {
                    'Transfer-Encoding': 'chunked',
                    'Content-Type': 'text/plain'
                },
                body: 'This is chunked transfer encoding test data'
            })
            .then(response => {
                log(`Chunked response status: ${response.status}`);
                return response.text();
            })
            .then(html => {
                const newWindow = window.open('', '_blank');
                newWindow.document.write(html);
                newWindow.document.close();
            })
            .catch(error => {
                log(`Chunked error: ${error}`);
            });
        }
        
        // Upload file
        function uploadFile(type) {
            let fileInput;
            switch(type) {
                case 'image': fileInput = document.getElementById('imageFile'); break;
                case 'video': fileInput = document.getElementById('videoFile'); break;
                case 'text': fileInput = document.getElementById('textFile'); break;
            }
            
            if (!fileInput.files.length) {
                alert('Please select a file first!');
                return;
            }
            
            const file = fileInput.files[0];
            log(`Uploading ${type} file: ${file.name} (${file.size} bytes)`);
            
            fetch('/cgi-bin/file_handler.py', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/octet-stream',
                    'X-File-Name': file.name,
                    'X-File-Type': file.type,
                    'X-File-Size': file.size.toString()
                },
                body: file
            })
            .then(response => {
                log(`File upload response status: ${response.status}`);
                return response.text();
            })
            .then(html => {
                const newWindow = window.open('', '_blank');
                newWindow.document.write(html);
                newWindow.document.close();
            })
            .catch(error => {
                log(`File upload error: ${error}`);
            });
        }
        
        // Upload multiple files
        function uploadMultipleFiles() {
            const fileInput = document.getElementById('multiFiles');
            if (!fileInput.files.length) {
                alert('Please select files first!');
                return;
            }
            
            log(`Uploading ${fileInput.files.length} files`);
            
            Array.from(fileInput.files).forEach((file, index) => {
                setTimeout(() => {
                    fetch('/cgi-bin/file_handler.py', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/octet-stream',
                            'X-File-Name': `multi_${index}_${file.name}`,
                            'X-File-Type': file.type,
                            'X-File-Size': file.size.toString()
                        },
                        body: file
                    })
                    .then(response => {
                        log(`Multi-file ${index + 1} response: ${response.status}`);
                    })
                    .catch(error => {
                        log(`Multi-file ${index + 1} error: ${error}`);
                    });
                }, index * 100); // Stagger uploads
            });
        }        

        // Create error scripts for testing
        function createErrorScript(type) {
            let scriptContent = '';
            let filename = '';
            
            switch(type) {
                case 'syntax':
                    filename = 'syntax_error.py';
                    scriptContent = `#!/usr/bin/env python3
print("Content-Type: text/html")
print()
print("<h1>This script has syntax errors</h1>")
# Intentional syntax error below
if True
    print("Missing colon causes syntax error")
`;
                    break;
                    
                case 'infinite':
                    filename = 'infinite_loop.py';
                    scriptContent = `#!/usr/bin/env python3
print("Content-Type: text/html")
print()
print("<h1>Infinite Loop Test</h1>")
print("<p>This script will run indefinitely...</p>")
while True:
    pass  # Infinite loop
`;
                    break;
                    
                case 'memory':
                    filename = 'memory_hog.py';
                    scriptContent = `#!/usr/bin/env python3
print("Content-Type: text/html")
print()
print("<h1>Memory Intensive Test</h1>")
print("<p>Allocating large amounts of memory...</p>")
# Allocate 100MB of memory
big_list = []
for i in range(1000000):
    big_list.append("x" * 100)
print(f"<p>Allocated memory for {len(big_list)} items</p>")
`;
                    break;
                    
                case 'permission':
                    filename = 'no_permission.py';
                    scriptContent = `#!/usr/bin/env python3
print("Content-Type: text/html")
print()
print("<h1>Permission Test</h1>")
print("<p>This script should not have execute permissions</p>")
`;
                    break;
                    
                case 'headers':
                    filename = 'bad_headers.py';
                    scriptContent = `#!/usr/bin/env python3
# Intentionally malformed headers
print("Invalid-Header-Format")
print("Content-Type text/html")  # Missing colon
print()
print("<h1>Bad Headers Test</h1>")
`;
                    break;
            }
            
            log(`Creating error script: ${filename}`);
            
            // Create the script via a POST request to a handler
            fetch('/cgi-bin/file_handler.py', {
                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain',
                    'X-File-Name': filename,
                    'X-Create-Script': 'true'
                },
                body: scriptContent
            })
            .then(response => {
                log(`Script creation response: ${response.status}`);
                if (type === 'permission') {
                    // For permission test, we need to remove execute permissions
                    log('Note: You may need to manually remove execute permissions from the script');
                }
                // Now test the script
                setTimeout(() => {
                    window.open(`/cgi-bin/${filename}`, '_blank');
                }, 1000);
            })
            .catch(error => {
                log(`Script creation error: ${error}`);
            });
        }
        
        // Concurrent requests test
        function runConcurrentTest() {
            const count = parseInt(document.getElementById('concurrentCount').value);
            log(`Starting concurrent test with ${count} requests`);
            
            const promises = [];
            const startTime = Date.now();
            
            for (let i = 0; i < count; i++) {
                const promise = fetch('/cgi-bin/hello.py')
                    .then(response => {
                        return { status: response.status, index: i };
                    })
                    .catch(error => {
                        return { error: error.message, index: i };
                    });
                promises.push(promise);
            }
            
            Promise.all(promises).then(results => {
                const endTime = Date.now();
                const duration = endTime - startTime;
                
                const successful = results.filter(r => r.status === 200).length;
                const failed = results.filter(r => r.error).length;
                
                log(`Concurrent test completed in ${duration}ms`);
                log(`Successful: ${successful}, Failed: ${failed}, Total: ${count}`);
                
                // Show detailed results
                document.getElementById('stressResults').style.display = 'block';
                document.getElementById('stressOutput').innerHTML = `
                    <p><strong>Duration:</strong> ${duration}ms</p>
                    <p><strong>Requests per second:</strong> ${(count / (duration / 1000)).toFixed(2)}</p>
                    <p><strong>Success rate:</strong> ${((successful / count) * 100).toFixed(2)}%</p>
                `;
            });
        }
        
        // Rapid fire test
        function runRapidFireTest() {
            log('Starting rapid fire test...');
            testCounter = 0;
            
            rapidFireInterval = setInterval(() => {
                testCounter++;
                fetch('/cgi-bin/hello.py')
                    .then(response => {
                        if (testCounter % 10 === 0) {
                            log(`Rapid fire: ${testCounter} requests sent`);
                        }
                    })
                    .catch(error => {
                        log(`Rapid fire error at request ${testCounter}: ${error}`);
                    });
            }, 10); // Send request every 10ms
        }
        
        function stopRapidFire() {
            if (rapidFireInterval) {
                clearInterval(rapidFireInterval);
                log(`Rapid fire test stopped after ${testCounter} requests`);
            }
        }
        
        // Large POST stress test
        function runLargePostStress() {
            log('Starting large POST stress test...');
            const largeData = 'x'.repeat(100000); // 100KB
            const promises = [];
            
            for (let i = 0; i < 10; i++) {
                const promise = fetch('/cgi-bin/post_test.py', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain'
                    },
                    body: largeData
                })
                .then(response => ({ status: response.status, index: i }))
                .catch(error => ({ error: error.message, index: i }));
                
                promises.push(promise);
            }
            
            Promise.all(promises).then(results => {
                const successful = results.filter(r => r.status === 200).length;
                log(`Large POST stress completed: ${successful}/10 successful`);
            });
        }
        
        // Mixed stress test
        function runMixedStress() {
            log('Starting mixed request stress test...');
            const requests = [];
            
            // Mix of different request types
            for (let i = 0; i < 20; i++) {
                if (i % 3 === 0) {
                    // GET request
                    requests.push(fetch('/cgi-bin/hello.py'));
                } else if (i % 3 === 1) {
                    // POST request
                    requests.push(fetch('/cgi-bin/post_test.py', {
                        method: 'POST',
                        body: `test data ${i}`
                    }));
                } else {
                    // Different CGI script
                    requests.push(fetch('/cgi-bin/enhanced_test.py'));
                }
            }
            
            Promise.allSettled(requests).then(results => {
                const successful = results.filter(r => r.status === 'fulfilled').length;
                log(`Mixed stress test completed: ${successful}/20 successful`);
            });
        }
        
        // Auto-scroll to sections
        document.querySelectorAll('.quick-links a').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('href').substring(1);
                const targetElement = document.getElementById(targetId);
                if (targetElement) {
                    targetElement.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            log('CGI Test Suite loaded and ready');
        });
    </script>
</body>
</html>